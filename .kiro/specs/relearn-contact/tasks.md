# Implementation Plan

- [x] 1. バックエンド: 再学習エンドポイントの実装
- [x] 1.1 再学習エンドポイントを追加する
  - 学習完了済みの連絡先に対して再学習を受け付けるPOSTエンドポイントを作成する
  - Firebase認証でユーザーを特定し、対象連絡先の所有権を検証する
  - 連絡先が学習完了状態であることを前提条件としてチェックし、未完了の場合は409を返す
  - 連絡先が存在しない場合は404、所有権がない場合は403、未認証の場合は401を返す
  - 既存の学習コンテキストを削除し、学習ステータスをリセットする
  - バックグラウンドタスクとして学習処理を登録し、202 Acceptedで即座にレスポンスを返す
  - 画面遷移してもバックグラウンド処理は中断されず継続する
  - _Requirements: 2.4, 3.4, 4.1, 4.3, 5.1, 5.2, 5.3, 5.4, 5.5_
  - **ユーザー作業**: コンソール作業なし。テストがパスすることを確認。

- [ ] 2. フロントエンド: 再学習API関数の追加
- [ ] 2.1 (P) 再学習用のAPI呼び出し関数を追加する
  - 再学習エンドポイントへPOSTリクエストを送信する関数を作成する
  - 既存のretry関数と同じ構造で、bodyなし、Contactオブジェクトを返却する
  - 409エラー時は「この連絡先は現在学習中です」、404エラー時は「連絡先が見つかりません」のメッセージを返す
  - _Requirements: 2.2, 4.2_
  - **ユーザー作業**: コンソール作業なし。テストがパスすることを確認。

- [ ] 3. フロントエンド: ContactCardへの再学習ボタン追加
- [ ] 3.1 再学習ボタンをContactCardに追加する
  - 学習完了ステータスの連絡先にのみ再学習ボタンを表示する
  - 学習中ステータスの連絡先では再学習ボタンを非表示にする
  - 学習失敗ステータスの連絡先では再学習ボタンを非表示にし、既存の再試行ボタンのみ表示する
  - 再学習ボタンクリック時にコールバックを呼び出す
  - _Requirements: 1.1, 1.2, 1.3, 3.1, 3.3_
  - **ユーザー作業**: コンソール作業なし。テストがパスすることを確認。

- [ ] 4. フロントエンド: ContactListへの再学習フロー統合
- [ ] 4.1 再学習の確認ダイアログとAPI呼び出しフローを実装する
  - 再学習ボタン押下時に確認ダイアログを表示し、ユーザーに再学習の実行可否を確認する
  - ユーザーが確認した場合、再学習APIを呼び出して連絡先のステータスを学習中に更新する
  - ユーザーがキャンセルした場合、何も実行せずダイアログを閉じる
  - API呼び出し成功時、連絡先一覧内の該当データをレスポンスで差し替える
  - ネットワークエラー時はエラーメッセージを表示し、連絡先のステータスを変更しない
  - 既存のポーリング機能により再学習中のステータスが自動的に更新される
  - ページに戻った際もポーリングで最新ステータスが反映される
  - _Requirements: 2.1, 2.2, 2.3, 2.5, 3.2, 3.5, 4.2_
  - **ユーザー作業**: コンソール作業なし。全タスク完了後、ブラウザで動作確認を推奨（学習完了済み連絡先で再学習ボタンをクリックし、ステータスが「学習中」→「学習完了」に遷移することを確認）。
